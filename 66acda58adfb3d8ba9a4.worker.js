!function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/3D-Cellular-Automata/",r(r.s=0)}([function(t,e,r){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){if(t){if("string"===typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function i(t){if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=a(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,s=!0,o=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){o=!0,i=t},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}r.r(e);var l=function(){function t(e){s(this,t),this.shape=e.shape,this.count=e.count,this.XY=e.XY,this.X=e.X,this.cells=e.cells,this.cells_buffer=e.cells_buffer,this.neighbours=e.neighbours,this.updates=e.updates,this.updates_buffer=e.updates_buffer,this.render_updates=e.render_updates,this.transferables=e.transferables}return u(t,null,[{key:"Create",value:function(e){var r={};return r.shape=e,r.count=e[0]*e[1]*e[2],r.XY=e[0]*e[1],r.X=e[0],r.cells=new Uint8Array(r.count),r.neighbours=new Uint8Array(r.count),r.updates=new Set,r.render_updates=new Set,r.transferables=[r.cells.buffer,r.neighbours.buffer],new t(r)}}]),u(t,[{key:"clear",value:function(){this.cells.fill(0,0,this.count),this.neighbours.fill(0,0,this.count),this.updates.clear(),this.render_updates.clear()}},{key:"xyz_to_i",value:function(t,e,r){return t+e*this.X+r*this.XY}},{key:"i_to_xyz",value:function(t){var e=Math.floor(t/this.XY);t-=e*this.XY;var r=Math.floor(t/this.X);return[t-r*this.X,r,e]}},{key:"i_to_xyz_inplace",value:function(t,e){var r=Math.floor(t/this.XY);t-=r*this.XY;var n=Math.floor(t/this.X),a=t-n*this.X;e[0]=a,e[1]=n,e[2]=r}}]),t}();function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function f(t){return(f="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){return!e||"object"!==f(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function v(t){return function(){var e,r=c(t);if(h()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return d(this,e)}}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}var y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,t),this.params=e}return u(t,null,[{key:"Create",value:function(t,e){switch(t){case"Seed Crystal":return new b(e);case"Seed Crystal Absolute":return new m(e);default:throw new Error("Invalid randomiser type: ".concat(t))}}}]),t}(),b=function(t){_(r,t);var e=v(r);function r(){return s(this,r),e.apply(this,arguments)}return u(r,[{key:"randomise",value:function(t,e){for(var r=this.params,n=r.radius,a=r.density,i=[Math.max(.5-n,0),Math.min(.5+n,1)],s=i[0],o=i[1],u=t.shape[0]-1,l=t.shape[1]-1,c=t.shape[2]-1,h=[Math.floor(u*s),Math.ceil(u*o)],f=h[0],d=h[1],v=[Math.floor(l*s),Math.ceil(l*o)],p=v[0],_=v[1],y=[Math.floor(c*s),Math.ceil(c*o)],b=y[0],m=y[1],g=f;g<=d;g++)for(var k=p;k<=_;k++)for(var w=b;w<=m;w++){var M=t.xyz_to_i(g,k,w);t.cells[M]!==e.alive_state&&(Math.random()<a&&(t.cells[M]=e.alive_state,e.add(g,k,w,t)))}}}]),r}(y),m=function(t){_(r,t);var e=v(r);function r(){return s(this,r),e.apply(this,arguments)}return u(r,[{key:"randomise",value:function(t,e){for(var r=this.params,n=r.radius,a=r.density,i=Math.floor(t.shape[0]/2),s=Math.floor(t.shape[1]/2),o=Math.floor(t.shape[2]/2),u=[Math.max(i-n,0),Math.min(i+n,t.shape[0]-1)],l=u[0],c=u[1],h=[Math.max(s-n,0),Math.min(s+n,t.shape[1]-1)],f=h[0],d=h[1],v=[Math.max(o-n,0),Math.min(o+n,t.shape[2]-1)],p=v[0],_=v[1],y=l;y<=c;y++)for(var b=f;b<=d;b++)for(var m=p;m<=_;m++){var g=t.xyz_to_i(y,b,m);t.cells[g]!==e.alive_state&&(Math.random()<a&&(t.cells[g]=e.alive_state,e.add(y,b,m,t)))}}}]),r}(y);function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(u){a=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return r}}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var k=function(){function t(e){s(this,t),this.max_neighbours=e}return u(t,[{key:"sub",value:function(t,e,r,n){}},{key:"add",value:function(t,e,r,n){}}]),t}(),w=function(t){_(r,t);var e=v(r);function r(){return s(this,r),e.call(this,26)}return u(r,[{key:"sub",value:function(t,e,r,n){this.add(t,e,r,n,-1)}},{key:"add",value:function(t,e,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=n.neighbours,s=n.updates,o=n.render_updates,u=n.xyz_to_i(t,e,r);s.add(u),o.add(u);for(var l=-1;l<=1;l++)for(var c=-1;c<=1;c++)for(var h=-1;h<=1;h++)if(0!==l||0!==c||0!==h){var f=x(t+l,n.shape[0]),d=x(e+c,n.shape[1]),v=x(r+h,n.shape[2]);i[u=n.xyz_to_i(f,d,v)]+=a,s.add(u),o.add(u)}}}]),r}(k),M=function(t){_(r,t);var e=v(r);function r(){var t;s(this,r),(t=e.call(this,6)).offsets=[];for(var n=0;n<3;n++){var a=[0,0,0],i=[0,0,0];a[n]=1,i[n]=-1,t.offsets.push(a),t.offsets.push(i)}return t}return u(r,[{key:"sub",value:function(t,e,r,n){this.add(t,e,r,n,-1)}},{key:"add",value:function(t,e,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=n.neighbours,o=n.updates,u=n.render_updates,l=n.xyz_to_i(t,e,r);o.add(l),u.add(l);var c,h=i(this.offsets);try{for(h.s();!(c=h.n()).done;){var f=c.value,d=x(t+f[0],n.shape[0]),v=x(e+f[1],n.shape[1]),p=x(r+f[2],n.shape[2]);s[l=n.xyz_to_i(d,v,p)]+=a,o.add(l),u.add(l)}}catch(_){h.e(_)}finally{h.f()}}}]),r}(k);function x(t,e){return(t%e+e)%e}var S=new w,O=new M,j=function(){function t(){s(this,t)}return u(t,null,[{key:"Create",value:function(t){var e=t.type;switch(e){case"M":return S;case"VN":return O;default:throw new Error("Unknown neighbour type: ".concat(e))}}}]),t}(),X=function(){function t(e,r,n,a){s(this,t),this.remain_alive=e,this.become_alive=r,this.total_states=n,this.alive_state=255,this.dead_state=0,this.neighbours=a;var i=(this.alive_state-this.dead_state)/(this.total_states-1);i=Math.floor(i),this.alive_threshold=Math.floor(this.alive_state-i),this.dead_threshold=Math.floor(i),this.delta=i}return u(t,null,[{key:"Create",value:function(e,r,n,a){return new t(e,r,n,a=j.Create(a))}}]),u(t,[{key:"update",value:function(t,e){var r=t.cells,n=t.neighbours,a=t.updates,s=t.render_updates,o=0,u=[],l=[],c=[],h=[];function f(t){e(o+=t)}var d,v=i(a);try{for(v.s();!(d=v.n()).done;){var p=d.value,_=n[p],y=r[p],b=this.get_next_state(y,_);r[p]=b,this.is_alive(y)&&!this.is_alive(b)?l.push(p):this.is_dead(y)&&this.is_alive(b)?c.push(p):y!==b?h.push(p):u.push(p)}}catch(D){v.e(D)}finally{v.f()}for(var m=0,k=u;m<k.length;m++){var w=k[m];a.delete(w)}f(u.length);for(var M=0,x=h;M<x.length;M++){var S=x[M];s.add(S)}f(h.length);for(var O=0,j=c;O<j.length;O++){var X=j[O],q=g(t.i_to_xyz(X),3),z=q[0],C=q[1],A=q[2];this.add(z,C,A,t)}f(c.length);for(var P=0,Y=l;P<Y.length;P++){var E=Y[P],T=g(t.i_to_xyz(E),3),I=T[0],R=T[1],U=T[2];this.sub(I,R,U,t)}f(l.length)}},{key:"get_next_state",value:function(t,e){if(this.is_alive(t)){if(this.remain_alive[e])return this.alive_state;var r=t-this.delta;return this.is_dead(r)?0:r}if(this.is_dead(t))return this.become_alive[e]?this.alive_state:this.dead_state;var n=t-this.delta;return this.is_dead(n)?0:n}},{key:"add",value:function(t,e,r,n){this.neighbours.add(t,e,r,n)}},{key:"sub",value:function(t,e,r,n){this.neighbours.sub(t,e,r,n)}},{key:"is_alive",value:function(t){return t>this.alive_threshold}},{key:"is_dead",value:function(t){return t<this.dead_threshold}}]),t}(),q=new(function(){function t(){var e=this;s(this,t),this.listeners=new Set,this.total_steps=0,this.running=!1,this.requested_step=!1,this.completed_frame=!1,this.grid_available=!0,this.local_rerender=!1,this.tasks={clear:{callback:function(){return e.clear()},queued:!1},randomise:{callback:function(){return e.randomise()},queued:!1},set_shape:{callback:function(){},queued:!1}}}return u(t,[{key:"attach_listener",value:function(t){return this.listeners.add(t)}},{key:"remove_listener",value:function(t){return this.listeners.delete(t)}},{key:"notify",value:function(t){var e,r=i(this.listeners);try{for(r.s();!(e=r.n()).done;){(0,e.value)(t)}}catch(n){r.e(n)}finally{r.f()}}},{key:"get_frame",value:function(){if(this.grid&&this.completed_frame){this.completed_frame=!1,this.grid_available=!1;var t=this.local_rerender;return this.local_rerender=!0,{grid:this.grid,local:t}}}},{key:"start",value:function(){this.running=!0}},{key:"stop",value:function(){this.running=!1}},{key:"run",value:function(){this.loop()}},{key:"loop",value:function(){var t=this;for(var e in this.tasks){var r=this.tasks[e];r.queued&&r.callback()}this.grid_available&&(this.running||this.requested_step)&&(this.calculate_frame(),this.requested_step=!1),setTimeout((function(){return t.loop()}),15)}},{key:"step",value:function(){this.requested_step=!0}},{key:"set_shape",value:function(t){var e=this;if(this.grid&&!this.grid_available)return this.tasks.set_shape.queued=!0,void(this.tasks.set_shape.callback=function(){return e.set_shape(t)});this.tasks.set_shape.queued=!1,this.tasks.set_shape.callback=function(){},this.grid=l.Create(t),this.total_steps=0,this.notify({total_steps:this.total_steps,total_blocks:0,completed_blocks:0,frame_time:0}),this.completed_frame=!0,this.local_rerender=!1}},{key:"set_grid",value:function(t){this.grid=new l(t),this.grid_available=!0}},{key:"set_rule",value:function(t){var e=t.remain,r=t.become,n=t.total_states,a=t.neighbour;this.rule=X.Create(e,r,n,a)}},{key:"set_randomiser",value:function(t){var e=t.type,r=t.params;this.randomiser=y.Create(e,r)}},{key:"clear",value:function(){this.grid&&this.grid_available?(this.tasks.clear.queued=!1,this.grid.clear(),this.total_steps=0,this.notify({total_steps:this.total_steps,total_blocks:0,completed_blocks:0,frame_time:0}),this.completed_frame=!0,this.local_rerender=!1):this.tasks.clear.queued=!0}},{key:"randomise",value:function(){if(this.randomiser&&this.rule)if(this.grid&&this.grid_available){this.tasks.randomise.queued=!1,this.randomiser.randomise(this.grid,this.rule);var t=this.grid.updates.size;this.notify({total_blocks:t,completed_blocks:0}),this.completed_frame=!0,this.local_rerender=this.local_rerender&&!0}else this.tasks.randomise.queued=!0}},{key:"calculate_frame",value:function(){var t=this,e=this.grid,r=this.rule;if(e&&r){this.grid_available=!1;var n=e.updates.size;this.notify({completed_blocks:0,total_blocks:n});var a=performance.now();r.update(e,(function(e){t.notify({completed_blocks:e})})),this.total_steps+=1;var i=performance.now()-a;this.notify({total_steps:this.total_steps,completed_blocks:n,frame_time:i,total_blocks:n}),this.completed_frame=!0,this.grid_available=!0,this.local_rerender=this.local_rerender&&!0}}}]),t}());q.attach_listener((function(t){postMessage({action:"stats",data:t})})),q.run(),onmessage=function(t){var e=t.data,r=e.action,n=e.id;try{switch(r){case"set_size":return q.set_shape(e.data);case"set_rule":return q.set_rule(e.data);case"set_randomiser":return q.set_randomiser(e.data);case"clear":return q.clear();case"randomise":return q.randomise();case"step":return q.step();case"start":return q.start();case"stop":return q.stop();case"request_frame":return function(){var t=q.get_frame();if(!t)return;var e=t.grid,r=t.local;postMessage({action:"grid",grid:e,local:r},e.transferables)}();case"set_grid":return q.set_grid(e.data)}}catch(a){postMessage({error:a,action:r,id:n})}}}]);
//# sourceMappingURL=66acda58adfb3d8ba9a4.worker.js.map